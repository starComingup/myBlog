<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx安全风险评估以及配置策略 | starcoming</title>
    <meta name="generator" content="VuePress 1.8.1">
    <link rel="icon" href="logo.png">
    <meta name="description" content="Star 互联网根据地">
    
    <link rel="preload" href="/myBlog/assets/css/0.styles.fb3985b6.css" as="style"><link rel="preload" href="/myBlog/assets/js/app.50c7974d.js" as="script"><link rel="preload" href="/myBlog/assets/js/2.1d8fec94.js" as="script"><link rel="preload" href="/myBlog/assets/js/22.e315ea7f.js" as="script"><link rel="prefetch" href="/myBlog/assets/js/10.1c777960.js"><link rel="prefetch" href="/myBlog/assets/js/11.1ecd2dbf.js"><link rel="prefetch" href="/myBlog/assets/js/12.17a1da9f.js"><link rel="prefetch" href="/myBlog/assets/js/13.8a794855.js"><link rel="prefetch" href="/myBlog/assets/js/14.2bb9244c.js"><link rel="prefetch" href="/myBlog/assets/js/15.8869bc9b.js"><link rel="prefetch" href="/myBlog/assets/js/16.0a5f97a2.js"><link rel="prefetch" href="/myBlog/assets/js/17.712f5db1.js"><link rel="prefetch" href="/myBlog/assets/js/18.76c6be13.js"><link rel="prefetch" href="/myBlog/assets/js/19.ab9162bd.js"><link rel="prefetch" href="/myBlog/assets/js/20.f68044ed.js"><link rel="prefetch" href="/myBlog/assets/js/21.211afa34.js"><link rel="prefetch" href="/myBlog/assets/js/23.0153ead4.js"><link rel="prefetch" href="/myBlog/assets/js/24.40c7e409.js"><link rel="prefetch" href="/myBlog/assets/js/25.8fedbe1b.js"><link rel="prefetch" href="/myBlog/assets/js/26.3557c4bb.js"><link rel="prefetch" href="/myBlog/assets/js/27.9a28b9bc.js"><link rel="prefetch" href="/myBlog/assets/js/28.cb3a74a1.js"><link rel="prefetch" href="/myBlog/assets/js/29.684c9f19.js"><link rel="prefetch" href="/myBlog/assets/js/3.d70ceed9.js"><link rel="prefetch" href="/myBlog/assets/js/30.c2843dd3.js"><link rel="prefetch" href="/myBlog/assets/js/31.51d91a08.js"><link rel="prefetch" href="/myBlog/assets/js/4.e48a78d5.js"><link rel="prefetch" href="/myBlog/assets/js/5.d9c5b5f0.js"><link rel="prefetch" href="/myBlog/assets/js/6.1d4193ca.js"><link rel="prefetch" href="/myBlog/assets/js/7.9494dbc0.js"><link rel="prefetch" href="/myBlog/assets/js/8.7dd360ea.js"><link rel="prefetch" href="/myBlog/assets/js/9.31816ce5.js">
    <link rel="stylesheet" href="/myBlog/assets/css/0.styles.fb3985b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myBlog/" class="home-link router-link-active"><!----> <span class="site-name">starcoming</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myBlog/Java/" class="nav-link">
  后端开发
</a></div><div class="nav-item"><a href="/myBlog/algorithm/" class="nav-link">
  算法探析
</a></div><div class="nav-item"><a href="/myBlog/sustain/" class="nav-link router-link-active">
  Linux运维
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="other Menu" class="dropdown-title"><span class="title">学到更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="other Menu" class="mobile-dropdown-title"><span class="title">学到更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/operatingsystem/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/yjs/compute_network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/yjs/compute_compose_principle/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/security/" class="nav-link">
  网络安全
</a></li></ul></div></div> <a href="https://github.com/starComingup/myBlog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/myBlog/Java/" class="nav-link">
  后端开发
</a></div><div class="nav-item"><a href="/myBlog/algorithm/" class="nav-link">
  算法探析
</a></div><div class="nav-item"><a href="/myBlog/sustain/" class="nav-link router-link-active">
  Linux运维
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="other Menu" class="dropdown-title"><span class="title">学到更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="other Menu" class="mobile-dropdown-title"><span class="title">学到更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/operatingsystem/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/yjs/compute_network/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/yjs/compute_compose_principle/" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/security/" class="nav-link">
  网络安全
</a></li></ul></div></div> <a href="https://github.com/starComingup/myBlog.git" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>运维笔记</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myBlog/sustain/" aria-current="page" class="sidebar-link">Linux运维</a></li><li><a href="/myBlog/sustain/shell.html" class="sidebar-link">SHELL编程</a></li><li><a href="/myBlog/sustain/custom_domain&amp;https.html" class="sidebar-link">HTTPS配置</a></li><li><a href="/myBlog/sustain/ssh.html" class="sidebar-link">SSH配置</a></li><li><a href="/myBlog/sustain/system-service.html" class="sidebar-link">系统服务</a></li><li><a href="/myBlog/sustain/nginx-security.html" aria-current="page" class="active sidebar-link">Nginx安全风险评估以及配置策略</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#身份鉴别类" class="sidebar-link">身份鉴别类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#检查是否配置nginx账号锁定策略" class="sidebar-link">检查是否配置Nginx账号锁定策略</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#服务配置类" class="sidebar-link">服务配置类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#检查nginx进程启动账号" class="sidebar-link">检查Nginx进程启动账号</a></li><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#nginx后端服务指定的header隐藏状态" class="sidebar-link">Nginx后端服务指定的Header隐藏状态</a></li><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#nginx的web访问日志记录状态" class="sidebar-link">Nginx的WEB访问日志记录状态</a></li><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#隐藏nginx服务的banner" class="sidebar-link">隐藏Nginx服务的Banner</a></li><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#针对nginx-ssl协议进行安全加固" class="sidebar-link">针对Nginx SSL协议进行安全加固</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#访问控制类" class="sidebar-link">访问控制类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#确保已禁用自动索引模块" class="sidebar-link">确保已禁用自动索引模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#文件权限类" class="sidebar-link">文件权限类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myBlog/sustain/nginx-security.html#确保nginx配置文件权限为644" class="sidebar-link">确保Nginx配置文件权限为644</a></li></ul></li></ul></li><li><a href="/myBlog/sustain/docker-security.html" class="sidebar-link">Docker安全风险评估以及配置策略</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx安全风险评估以及配置策略"><a href="#nginx安全风险评估以及配置策略" class="header-anchor">#</a> Nginx安全风险评估以及配置策略</h1> <div class="custom-block tip"><p class="custom-block-title">参考来源</p> <p>阿里云安全中心基线检查，该部分仅为最佳安全实践，仅供参考</p></div> <p></p><div class="table-of-contents"><ul><li><a href="#身份鉴别类">身份鉴别类</a><ul><li><a href="#检查是否配置nginx账号锁定策略">检查是否配置Nginx账号锁定策略</a></li></ul></li><li><a href="#服务配置类">服务配置类</a><ul><li><a href="#检查nginx进程启动账号">检查Nginx进程启动账号</a></li><li><a href="#nginx后端服务指定的header隐藏状态">Nginx后端服务指定的Header隐藏状态</a></li><li><a href="#nginx的web访问日志记录状态">Nginx的WEB访问日志记录状态</a></li><li><a href="#隐藏nginx服务的banner">隐藏Nginx服务的Banner</a></li><li><a href="#针对nginx-ssl协议进行安全加固">针对Nginx SSL协议进行安全加固</a></li></ul></li><li><a href="#访问控制类">访问控制类</a><ul><li><a href="#确保已禁用自动索引模块">确保已禁用自动索引模块</a></li></ul></li><li><a href="#文件权限类">文件权限类</a><ul><li><a href="#确保nginx配置文件权限为644">确保Nginx配置文件权限为644</a></li></ul></li></ul></div><p></p> <h2 id="身份鉴别类"><a href="#身份鉴别类" class="header-anchor">#</a> 身份鉴别类</h2> <h3 id="检查是否配置nginx账号锁定策略"><a href="#检查是否配置nginx账号锁定策略" class="header-anchor">#</a> 检查是否配置Nginx账号锁定策略</h3> <p><strong>描述</strong></p> <p>1.执行系统命令passwd -S nginx来查看锁定状态 出现Password locked证明锁定成功 如：nginx LK ..... (Password locked.)或nginx L .... 2.默认符合，修改后才有（默认已符合） 3.执行系统命令passwd -l nginx进行锁定</p> <hr> <p><strong>检查提示</strong></p> <p>--</p> <hr> <p><strong>加固建议</strong></p> <p>配置Nginx账号登录锁定策略： Nginx服务建议使用非root用户(如nginx，nobody)启动，并且确保启动用户的状态为锁定状态。可执行passwd -l &lt;Nginx启动用户&gt; 如<code>passwd -l nginx</code> 来锁定Nginx服务的启动用户。命令 <code>passwd -S &lt;用户&gt;</code> 如<code>passwd -S nginx</code>可查看用户状态。 修改配置文件中的nginx启动用户修改为nginx或nobody 如： <code>user nobody;</code> 如果您是docker用户，可忽略该项（或添加白名单）</p> <hr> <p>操作时建议做好记录或备份</p> <hr> <h2 id="服务配置类"><a href="#服务配置类" class="header-anchor">#</a> 服务配置类</h2> <h3 id="检查nginx进程启动账号"><a href="#检查nginx进程启动账号" class="header-anchor">#</a> 检查Nginx进程启动账号</h3> <p><strong>描述</strong></p> <p>Nginx进程启动账号状态，降低被攻击概率</p> <hr> <p><strong>检查提示</strong></p> <p>--</p> <hr> <p><strong>加固建议</strong></p> <p>修改Nginx进程启动账号： 1、打开<code>conf/nginx.conf</code>配置文件； 2、查看配置文件的user配置项，确认是非root启动的； 3、如果是<code>root</code>启动，修改成<code>nobody</code>或者<code>nginx账号</code>； 备注： 4、修改完配置文件之后需要重新启动Nginx。</p> <hr> <p>操作时建议做好记录或备份</p> <hr> <h3 id="nginx后端服务指定的header隐藏状态"><a href="#nginx后端服务指定的header隐藏状态" class="header-anchor">#</a> Nginx后端服务指定的Header隐藏状态</h3> <p><strong>描述</strong></p> <p>隐藏Nginx后端服务X-Powered-By头</p> <hr> <p><strong>检查提示</strong></p> <p>--</p> <hr> <p><strong>加固建议</strong></p> <p>隐藏Nginx后端服务指定Header的状态： 1、打开<code>conf/nginx.conf</code>配置文件； 2、在<code>http</code>下配置<code>proxy_hide_header</code>项； 增加或修改为 <code>proxy_hide_header X-Powered-By;</code> <code>proxy_hide_header Server;</code></p> <hr> <p>操作时建议做好记录或备份</p> <hr> <h3 id="nginx的web访问日志记录状态"><a href="#nginx的web访问日志记录状态" class="header-anchor">#</a> Nginx的WEB访问日志记录状态</h3> <p><strong>描述</strong></p> <p>应为每个核心站点启用access_log指令。默认情况下启用。</p> <hr> <p><strong>检查提示</strong></p> <p>--</p> <hr> <p><strong>加固建议</strong></p> <p>开启Nginx的WEB访问日志记录： 1、打开<code>conf/nginx.conf</code>配置文件，含主配置文件中include项包含的子配置文件； 2、在http下配置<code>access_log</code>项
<code>access_log logs/host.access.log main;</code> 3、并在主配置文件，及主配置文件下的include文件中 删除<code>off</code>项或配置为适当值</p> <hr> <p>操作时建议做好记录或备份</p> <hr> <h3 id="隐藏nginx服务的banner"><a href="#隐藏nginx服务的banner" class="header-anchor">#</a> 隐藏Nginx服务的Banner</h3> <p><strong>描述</strong></p> <p>Nginx服务的Banner隐藏状态</p> <hr> <p><strong>检查提示</strong></p> <p>--</p> <hr> <p><strong>加固建议</strong></p> <p>Nginx后端服务指定的Header隐藏状态隐藏Nginx服务Banner的状态： 1、打开<code>conf/nginx.conf</code>配置文件； 2、在server栏目下，配置<code>server_tokens</code>项 <code>server_tokens off;</code> 如出现多项不支持，执行<code>ln &lt;conf_path&gt; /etc/nginx/nginx.conf</code></p> <hr> <p>操作时建议做好记录或备份</p> <hr> <h3 id="针对nginx-ssl协议进行安全加固"><a href="#针对nginx-ssl协议进行安全加固" class="header-anchor">#</a> 针对Nginx SSL协议进行安全加固</h3> <p><strong>描述</strong></p> <p>Nginx SSL协议的加密策略进行加固</p> <hr> <p><strong>检查提示</strong></p> <p>--</p> <hr> <p><strong>加固建议</strong></p> <p>Nginx SSL协议采用TLSv1.2： 1、打开<code>conf/nginx.conf</code>配置文件（或主配置文件中的inlude文件）； 2、配置</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>server { 
               ...
              ssl_protocols TLSv1.2;
               ...
                     }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>备注：配置此项请确认nginx支持OpenSSL，运行<code>nginx -V</code> 如果返回中包含<code>built with OpenSSL</code>则表示支持OpenSSL。 如不支持，可能需要增加配置ssl_protocols TLSv1 TLSv1.1 TLSv1.2; 如果尚未配置ssl协议，请尽快配置（参考连接<a href="https://www.nginx.cn/doc/optional/ssl.html%EF%BC%89" target="_blank" rel="noopener noreferrer">https://www.nginx.cn/doc/optional/ssl.html）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <p>操作时建议做好记录或备份</p> <hr> <h2 id="访问控制类"><a href="#访问控制类" class="header-anchor">#</a> 访问控制类</h2> <h3 id="确保已禁用自动索引模块"><a href="#确保已禁用自动索引模块" class="header-anchor">#</a> 确保已禁用自动索引模块</h3> <p><strong>描述</strong></p> <p>自动索引模块处理以斜杠字符结尾的请求。此功能启用目录列表，这在攻击者侦察中可能很有用，因此应将其禁用。</p> <hr> <p><strong>检查提示</strong></p> <p>--</p> <hr> <p><strong>加固建议</strong></p> <p>执行以下操作以禁用自动索引模块: 搜索NGINX配置文件（NGINX.conf和任何包含的配置文件）以查找autoindex指令。
<code>egrep -i '^\s*autoindex\s+' &lt;main_config_path&gt;</code> <code>egrep -i '^\s*autoindex\s+' &lt;sub_config_path&gt;</code> 在location下删除或者修改为 <code>autoindex off;</code></p> <hr> <p>操作时建议做好记录或备份</p> <hr> <h2 id="文件权限类"><a href="#文件权限类" class="header-anchor">#</a> 文件权限类</h2> <h3 id="确保nginx配置文件权限为644"><a href="#确保nginx配置文件权限为644" class="header-anchor">#</a> 确保Nginx配置文件权限为644</h3> <p><strong>描述</strong></p> <p>把控配置文件权限以抵御外来攻击</p> <hr> <p><strong>检查提示</strong></p> <p>--</p> <hr> <p><strong>加固建议</strong></p> <p>修改Nginx配置文件权限： 执行<code>chmod 644 &lt;conf_path&gt;</code>来限制Nginx配置文件的权限；(&lt;conf_path&gt;为配置文件的路径，如默认/安装目录/conf/nginx.conf或者/etc/nginx/nginx.conf，或用户自定义，请 自行查找)</p> <hr> <p>操作时建议做好记录或备份</p> <hr></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/starComingup/myBlog.git/edit/main/docs/sustain/nginx-security.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/21/2021, 4:52:54 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myBlog/sustain/system-service.html" class="prev">
        系统服务
      </a></span> <span class="next"><a href="/myBlog/sustain/docker-security.html">
        Docker安全风险评估以及配置策略
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><div></div></div></div>
    <script src="/myBlog/assets/js/app.50c7974d.js" defer></script><script src="/myBlog/assets/js/2.1d8fec94.js" defer></script><script src="/myBlog/assets/js/22.e315ea7f.js" defer></script>
  </body>
</html>

(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{480:function(s,t,a){"use strict";a.r(t);var e=a(12),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"系统服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统服务"}},[s._v("#")]),s._v(" 系统服务")]),s._v(" "),a("h2",{attrs:{id:"什么是系统服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是系统服务"}},[s._v("#")]),s._v(" 什么是系统服务")]),s._v(" "),a("p",[s._v("系统服务"),a("code",[s._v("Daemon")]),s._v("就是在后台运行的程序，提供本地系统或网络功能。由于 "),a("code",[s._v("Daemon")]),s._v(' 的英文原意是"守护神"，所以经常将系统服务称为 '),a("code",[s._v("守护进程")]),s._v("。比如 "),a("code",[s._v("apache")]),s._v(" 就是实现 Web 服务的, 其服务进程是守护进程 "),a("code",[s._v("httpd")]),s._v("。")]),s._v(" "),a("blockquote",[a("p",[s._v("Linux 中就是通过启动 httpd 进程来启动 apache 服务。")])]),s._v(" "),a("h2",{attrs:{id:"服务的分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务的分类"}},[s._v("#")]),s._v(" 服务的分类")]),s._v(" "),a("p",[s._v("Linux服务按照安装方法不同可以分为 "),a("code",[s._v("RPM包服务")]),s._v("和"),a("code",[s._v("源码包服务")]),s._v("两大类。其中，RPM 包服务根据启动方法不同分为"),a("code",[s._v("独立服务")]),s._v("和"),a("code",[s._v("基于xinetd的服务")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"软件包的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#软件包的区别"}},[s._v("#")]),s._v(" 软件包的区别")]),s._v(" "),a("p",[s._v("软件包的区别是安装位置不同，"),a("code",[s._v("源码包")]),s._v("安装到手工指定的位置，不能被服务管理命令识别; 而 "),a("code",[s._v("RPM")]),s._v(" 包安装到系统默认位置，可以被服务管理命令识别；所以，"),a("code",[s._v("RPM")]),s._v(" 包服务和源码包服务的管理方法不同，把它们作为不同的服务分类。")]),s._v(" "),a("h2",{attrs:{id:"rpm-包服务分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rpm-包服务分类"}},[s._v("#")]),s._v(" RPM 包服务分类")]),s._v(" "),a("p",[s._v("RPM包服务又可以分为两种:")]),s._v(" "),a("ul",[a("li",[s._v("独立服务: 可以自行启动，不依赖其他的管理服务, 所以响应非常快，如 "),a("code",[s._v("apache")]),s._v("、"),a("code",[s._v("vsftp")]),s._v("、"),a("code",[s._v("Samba")]),s._v(" 等。")]),s._v(" "),a("li",[s._v("基于xinetd的服务: 不能独立启动，客户请求时通过 "),a("code",[s._v("xinetd")]),s._v(" 唤醒相应服务, 请求结束后，被唤醒的服务关闭释放资源。其优点是只要启动 xinetd 服务，而其他服务只在需要时启动，不会占用过多的资源。缺点是响应时间相对较长。")])]),s._v(" "),a("blockquote",[a("p",[s._v("xinetd 服务是系统的超级守护进程，作用是管理不能独立启动的服务。")])]),s._v(" "),a("h2",{attrs:{id:"xinetd-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xinetd-服务"}},[s._v("#")]),s._v(" xinetd 服务")]),s._v(" "),a("p",[s._v("系统默认是不安装 "),a("code",[s._v("xinetd")]),s._v(" 守护进程，需要手工安装。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ yum  -y  install  xinetd*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"源码包服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码包服务"}},[s._v("#")]),s._v(" 源码包服务")]),s._v(" "),a("p",[s._v("源码包服务其安装位置都是手工指定的，所以不能被系统服务管理命令直接识别，每种服务的启动方法都是通过不同的启动脚本，需要查看说明文档才能确定。")]),s._v(" "),a("h2",{attrs:{id:"如何区分rpm包服务和源码包服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何区分rpm包服务和源码包服务"}},[s._v("#")]),s._v(" 如何区分RPM包服务和源码包服务")]),s._v(" "),a("p",[s._v("区分RPM包服务和源码包服务的方法一般"),a("strong",[s._v("通过安装位置判断")]),s._v("，源码包服务不能被服务管理命令直接找到的，一般会安装到 "),a("code",[s._v("/usr/local/")]),s._v(" 目录中；"),a("code",[s._v("RPM")]),s._v(" 包服务都会安装到系统默认位置，可以被服务管理命令 "),a("code",[s._v("service|chkconfig")]),s._v(" 识别。")]),s._v(" "),a("h2",{attrs:{id:"如何区分独立服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何区分独立服务"}},[s._v("#")]),s._v(" 如何区分独立服务")]),s._v(" "),a("p",[s._v("通过 "),a("code",[s._v("chkconfig")]),s._v(" 可以区分"),a("code",[s._v("独立服务")]),s._v("和基于 "),a("code",[s._v("xinetd")]),s._v(" 的服务。"),a("code",[s._v("chkconfig")]),s._v(" 是管理 "),a("code",[s._v("RPM")]),s._v(" 包服务的自启动的命令，可以查询 "),a("code",[s._v("RPM")]),s._v(" 包默认安装的所有服务。命令格式如下:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# --list: 显示RPM包安装的所有服务的自启动状态；\n$ chkconfig --list [服务名]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"chkconfig范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chkconfig范例"}},[s._v("#")]),s._v(" chkconfig范例")]),s._v(" "),a("p",[s._v("第一列为服务名，后面 "),a("code",[s._v("0~6")]),s._v(" 代表在不同的运行级别中服务是否自动启动。基于xinetd的服务不是独立的服务，没有自己的运行级别，在任何运行级别都可以自启动。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --list\nabrt-ccpp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":关闭\nabrt-oops "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":关闭\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nudev-post "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": 启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":关闭\nxinetd "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":启用 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":关闭\nypbind "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":关闭 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":关闭\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基于 xinetd 的服务")]),s._v("\nchargen-stream: 关闭\ndaytime-dgram: 关闭\necho-stream: 关闭\nrsync: 关闭\ntcpmux-server: 关闭\ntime-stream: 关闭\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#端口"}},[s._v("#")]),s._v(" 端口")]),s._v(" "),a("p",[s._v("服务是给系统提供功能的，除了有系统服务，还有网络服务。每个网络服务都有自己的端口，一般端口号都是固定的。")]),s._v(" "),a("h2",{attrs:{id:"什么是端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是端口"}},[s._v("#")]),s._v(" 什么是端口")]),s._v(" "),a("p",[s._v("IP地址只能用来找到服务器，但是服务器上有可能搭建了多个网络服务，比如 "),a("code",[s._v("WWW")]),s._v(" 服务、"),a("code",[s._v("FTP")]),s._v(" 服务、"),a("code",[s._v("Mail")]),s._v(" 服务，要访问哪个网络服务呢？这时就要靠端口来区分了，因为每个网络服务对应的端口都是固定的。根据 "),a("code",[s._v("IETF")]),s._v(" 规定，"),a("code",[s._v("WWW")]),s._v(" 服务对应的端口是 "),a("code",[s._v("80")]),s._v("，"),a("code",[s._v("FTP")]),s._v(" 服务对应的端口是 "),a("code",[s._v("20")]),s._v(" 和 "),a("code",[s._v("21")]),s._v("，"),a("code",[s._v("Mail")]),s._v(" 服务对应的端口是 "),a("code",[s._v("25")]),s._v(" 和 "),a("code",[s._v("110")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"网络协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络协议"}},[s._v("#")]),s._v(" 网络协议")]),s._v(" "),a("p",[s._v("网络协议主要分为两大类:")]),s._v(" "),a("ul",[a("li",[s._v("TCP协议: 面向连接的可靠 "),a("code",[s._v("传输控制协议")])]),s._v(" "),a("li",[s._v("UDP协议: 面向无连接的不可靠 "),a("code",[s._v("用户数据报协议")])])]),s._v(" "),a("h2",{attrs:{id:"协议端口类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#协议端口类型"}},[s._v("#")]),s._v(" 协议端口类型")]),s._v(" "),a("p",[s._v("上面的两种协议都支持 "),a("code",[s._v("65535")]),s._v(" 个端口, 服务与端口的对应关系保存在"),a("code",[s._v("/etc/services")]),s._v("文件中。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/services\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# FTP服务端口")]),s._v("\nftp-data "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("/tcp\nftp-data "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("/udp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("/tcp\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v("/udp\nfsp fspd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 邮件发送端口")]),s._v("\nsmtp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("/tcp mail\nsmtp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("/udp mail\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WWW服务端口")]),s._v("\nhttp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp www www-http "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#WorldWideWeb HTTP")]),s._v("\nhttp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/udp www www-http "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#HyperText Transfer Protocol")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 邮件接收端口")]),s._v("\npop3 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v("/tcp pop-3\npop3 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v("/udp pop-3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h2",{attrs:{id:"修改服务端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改服务端口"}},[s._v("#")]),s._v(" 修改服务端口")]),s._v(" "),a("p",[s._v("网络服务的端口是能够修改的，不过一旦修改了端口，客户机就不知道服务器端口是什么，也就不能正确地获取服务了。所以，除非在实验环境下，否则不要修改端口。")]),s._v(" "),a("h2",{attrs:{id:"查询系统中已经启动的服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询系统中已经启动的服务"}},[s._v("#")]),s._v(" 查询系统中已经启动的服务")]),s._v(" "),a("p",[s._v("我们可以通过查询"),a("code",[s._v("开启的端口")]),s._v("，判断服务器开启了哪些服务, 命令格式如下。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" 选项\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选项: ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -a: 列出所有网络连接(已经连接的网络服务|监听网络服务|Socket套接字)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -t: 列出 TCP 数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -u: 列出 UDF 数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -l: 列出正在监听的网络服务(不包含已经连接的网络服务)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -n: 用端口号来显示而不用服务名；")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p: 列出该服务的进程PID；")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"查询服务范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询服务范例"}},[s._v("#")]),s._v(" 查询服务范例")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tlunp\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Active Internet connections (only servers)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcp 0 0 0.0.0.0:53575 0.0.0.0:*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LISTEN")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1200/rpc.statd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcp 0 0 0.0.0.0:111 0.0.0.0:* LISTEN 1181/rpcbind")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcp 0 0 0.0.0.0:22 O.O.O.O:* LISTEN 1405/sshd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcp 0 0 127.0.0.1:25 O.O.O.O:* LISTEN 1481/master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcp 0 0 :::57454 :::* LISTEN 1200/rpc.statd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# udp 0 0 0.0.0.0:58322 0.0.0.0:* 1276/avahi-daemon")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# udp 0 0 0.0.0.0:5353 O.O.O.O:* 1276/avahi-daemon")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# udp 0 0 0.0.0.0:111 O.O.O.O:* 1181/rpcbind")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# udp 0 0 :::111 :::* 1181/rpcbind")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# udp 0 0 :::47858 :::* 1200/rpc.statd")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h2",{attrs:{id:"netstat执行结果说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#netstat执行结果说明"}},[s._v("#")]),s._v(" netstat执行结果说明")]),s._v(" "),a("p",[s._v("netstat命令可以查看所有已经开启的端口，也就知道当前服务器上开启了哪些服务。")]),s._v(" "),a("ul",[a("li",[s._v("Proto: 数据包的协议，分为 "),a("code",[s._v("TCP")]),s._v(" 和 "),a("code",[s._v("UDP")]),s._v(" 数据包")]),s._v(" "),a("li",[s._v("Recv-Q: 收到的数据已经在本地接收缓冲，但是还没有被进程取走的数据包数量")]),s._v(" "),a("li",[s._v("Send-Q: 对方没有收到的数据包数量, 或者没有 "),a("code",[s._v("Ack回复")]),s._v(" 还在本地缓冲区的数据包数量")]),s._v(" "),a("li",[s._v("Local Address: 本地IP端口, 可以知道本机开启了哪些服务")]),s._v(" "),a("li",[s._v("Foreign Address: 远程主机端口, 即远程主机的IP和端口")]),s._v(" "),a("li",[s._v("State: 连接状态，有已经建立连接 "),a("code",[s._v("ESTABLISED")]),s._v(" 和监听 "),a("code",[s._v("LISTEN")]),s._v(" 两种状态")]),s._v(" "),a("li",[s._v("PID/Program name: 进程ID和进程命令名称")])]),s._v(" "),a("h2",{attrs:{id:"查询服务范例-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询服务范例-2"}},[s._v("#")]),s._v(" 查询服务范例")]),s._v(" "),a("p",[a("code",[s._v("netstat -an")]),s._v(" 能査看更多的信息，包括"),a("code",[s._v("Socket")]),s._v("套接字。除网络服务可以绑定端口，系统网络程序或自己开发的网络程序也可以绑定端口，用端口来接收客户端的请求数据。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -an\nActive Internet connections "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servers and established"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto Recv-Q Send-Q Local Address Foreign Address State\ntcp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:53575 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:* LISTEN\ntcp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:22 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:* LISTEN\ntcp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:631 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:* LISTEN\ntcp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:25 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:* LISTEN\ntcp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.210:22 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.105:4868 ESTABLISHED\ntcp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::57454 :::* LISTEN\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nudp "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::932 :::*\nActive UNIX domain sockets "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servers and established"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto RefCnt Flags Type State I-Node Path\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Socket套接字输出")]),s._v("\nUnix "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ACC "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" STREAM LISTENING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11712")]),s._v(" /var/run/dbus/system_bus_socket\nunix "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ACC "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" STREAM LISTENING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8450")]),s._v(" @/com/ubuntu/upstart unix "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" DGRAM "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8651")]),s._v(" @/org/kernel/udev/udevd\nunix "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" ACC "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" STREAM LISTENING "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11942")]),s._v(" @/var/run/hald/dbus-b4QVLkivf1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h2",{attrs:{id:"socket"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#socket"}},[s._v("#")]),s._v(" Socket")]),s._v(" "),a("p",[s._v("网络服务或网络程序要想在网络中传递数据，必须利用 "),a("code",[s._v("Socket")]),s._v(" 套接字绑定端口，并进行数据传递。"),a("code",[s._v("Socket")]),s._v(" 套接字虽然不是网络服务，但是同样会占用端口，并在网络中传递数据。 "),a("code",[s._v("Socket")]),s._v(" 套接字的输出:")]),s._v(" "),a("ul",[a("li",[s._v("Proto: 协议名称，一般是unix")]),s._v(" "),a("li",[s._v("RefCnt: 连接到Socket的进程数")]),s._v(" "),a("li",[s._v("Flags: 连接标识")]),s._v(" "),a("li",[s._v("Type: Socket访问类型")]),s._v(" "),a("li",[s._v("State: 状态(LISTENING|CONNECTED)")]),s._v(" "),a("li",[s._v("I-Node: 程序文件的 i 节点号")]),s._v(" "),a("li",[s._v("Path: Socke路径或相关数据输出路径")])]),s._v(" "),a("h2",{attrs:{id:"独立服务的启动管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#独立服务的启动管理"}},[s._v("#")]),s._v(" 独立服务的启动管理")]),s._v(" "),a("p",[s._v("独立服务的启动主要有两种方法。")]),s._v(" "),a("ul",[a("li",[s._v("使用 "),a("code",[s._v("/etc/init.d/")]),s._v(" 目录中的启动脚本来启动独立的服务")]),s._v(" "),a("li",[s._v("使用service命令来启动独立的服务")])]),s._v(" "),a("h2",{attrs:{id:"etc-init-d-启动脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etc-init-d-启动脚本"}},[s._v("#")]),s._v(" /etc/init.d/ 启动脚本")]),s._v(" "),a("p",[s._v("调用/etc/init.d/文件夹的脚本可以启动独立服务，一般推荐采用这种方式，命令格式如下:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ /etc/init.d/独立服务名 start"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("stop"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("status"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("restart\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选项")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - start:   启动服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - stop:    停止服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - status:  查看服务状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - restart: 重启动服务")]),s._v("\n\n$ /etc/init.d/httpd start"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("stop"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("status\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"service启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service启动服务"}},[s._v("#")]),s._v(" service启动服务")]),s._v(" "),a("p",[s._v("CentOS还可以使用 "),a("code",[s._v("service")]),s._v(" 命令启动独立的服务, 它仍然要调用 "),a("code",[s._v("/etc/init.d/")]),s._v(" 的启动脚本来启动服务。该命令是红帽专有命令，其他发行版本不一定有这条命令，所以并不推荐使用。service 命令格式如下:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --status -all: 列出所有独立服务的启动状态")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" 独立服务名 start"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("stop"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 httpd 服务")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" httpd start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有独立服务的启动状态")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" --status -all\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[s._v("随着 "),a("code",[s._v("httpd")]),s._v(" 服务的启动和停止，使用 "),a("code",[s._v("netstat -tlun")]),s._v(" 命令就会看到 "),a("code",[s._v("80")]),s._v(" 端口出现和消失, 说明 "),a("code",[s._v("apache")]),s._v(" 绑定端口是 "),a("code",[s._v("80")]),s._v("。")])]),s._v(" "),a("h2",{attrs:{id:"独立服务的自启动管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#独立服务的自启动管理"}},[s._v("#")]),s._v(" 独立服务的自启动管理")]),s._v(" "),a("p",[s._v("自启动是指服务是否随着系统启动而自动启动。独立服务的自启动方法有三种如下。")]),s._v(" "),a("ul",[a("li",[s._v("使用 "),a("code",[s._v("chkconfig")]),s._v(" 服务自启动管理命令")]),s._v(" "),a("li",[s._v("修改 "),a("code",[s._v("/etc/rc.d/rc.local")]),s._v(" 文件")]),s._v(" "),a("li",[s._v("使用 "),a("code",[s._v("ntsysv")]),s._v(" 管理自启动")])]),s._v(" "),a("h2",{attrs:{id:"chkconfig"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chkconfig"}},[s._v("#")]),s._v(" chkconfig")]),s._v(" "),a("p",[a("code",[s._v("chkconfig")]),s._v(" 可以设置RPM包服务的自启动状态，"),a("code",[s._v("独立服务")]),s._v("和"),a("code",[s._v("基于xinetd的服务")]),s._v("的设定方法不同。命令格式如下:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("$ chkconfig [--level 运行级别][独立服务名][on|off]\n\n# 选项\n--level: 设定开机自启动的运行级别 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[a("code",[s._v("chkconfig")]),s._v("只能识别RPM包服务，不能配置源码包服务。")])]),s._v(" "),a("h2",{attrs:{id:"chkconfig-范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chkconfig-范例"}},[s._v("#")]),s._v(" chkconfig 范例")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 所有级别都不是自启动\n$ chkconfig --list | grep httpd\nhttpd 0:关闭 1:关 2:关 3:关 4:关 5:关 6:关\n# 打开2、3、4、5级别的自启动\n$ chkconfig --level 2345 httpd on\n# 2、3、4、5级别开启\n$ chkconfig --list | grep httpd\nhttpd 0:关闭 1:关 2:开 3:开 4:开 5:开 6:关\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"修改-etc-rc-d-rc-local-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改-etc-rc-d-rc-local-文件"}},[s._v("#")]),s._v(" 修改 /etc/rc.d/rc.local 文件")]),s._v(" "),a("p",[s._v("第二种方法是修改 "),a("code",[s._v("/etc/rc.d/rc.local")]),s._v(" 文件，加入服务的启动命令。该文件是在系统启动时，在输入用户名和密码之前最后读取的文件，文件中的命令，都会在系统启动时调用。")]),s._v(" "),a("blockquote",[a("p",[s._v("注意: "),a("code",[s._v("/etc/rc.d/rc.loca")]),s._v("和"),a("code",[s._v("/etc/rc.local")]),s._v(" 文件是软链接，修改哪个文件都可以")])]),s._v(" "),a("h2",{attrs:{id:"范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例"}},[s._v("#")]),s._v(" 范例")]),s._v(" "),a("p",[s._v("如果把某个服务的启动命令放入这个文件，该服务就会在开机时自启动。比如下面范例，修改后只要重启系统，"),a("code",[s._v("apache")]),s._v(" 服务就会开机自启动了。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/rc.d/rc.local\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入apache的启动命令")]),s._v("\n/etc/rc.d/init.d/httpd start\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"etc-rc-d-rc-local-方法的优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#etc-rc-d-rc-local-方法的优点"}},[s._v("#")]),s._v(" /etc/rc.d/rc.local 方法的优点")]),s._v(" "),a("p",[s._v("推荐使用该方法管理自启动，有两点好处:")]),s._v(" "),a("ul",[a("li",[s._v("遇到陌生服务器时，只要查看该文件就知道自启动了哪些服务，便于集中管理。")]),s._v(" "),a("li",[s._v("源码包服务的自启动可以通过该文件实现自启动")])]),s._v(" "),a("blockquote",[a("p",[s._v("注意: 修改 "),a("code",[s._v("/etc/rc.d/rc.local")]),s._v(" 文件的结果，不会在 "),a("code",[s._v("chkconfig --list")]),s._v('" 中显示自启动的服务列表')])]),s._v(" "),a("h2",{attrs:{id:"ntsysv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ntsysv"}},[s._v("#")]),s._v(" ntsysv")]),s._v(" "),a("p",[s._v("第三种方法是使用 "),a("code",[s._v("ntsysv")]),s._v(" 命令调用窗口模式来管理服务的自启动。命令格式如下, 执行后会和 setup 命令类似出现命令界面。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntsysv\n$ ntsysv "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--level 运行级别"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选项: ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --level 运行级别: 可以指定设定自启动的运行级别；")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只设定2、3、5级别的服务自启动")]),s._v("\n$ ntsysv --level "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("235")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按默认的运行级别设置服务自启动")]),s._v("\n$ ntsysv\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("blockquote",[a("p",[s._v("注意: ntsysv 不仅可以管理独立服务，也可以管理xinetd服务, 但是不能管理源码包服务。而且它是红帽系列的专有命令，其他发行版本不一定有，所以推荐使用文件管理自启动。")])]),s._v(" "),a("h2",{attrs:{id:"基于-xinetd-服务的启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于-xinetd-服务的启动"}},[s._v("#")]),s._v(" 基于 xinetd 服务的启动")]),s._v(" "),a("p",[s._v("基于xinetd的服务修改配置文件就可以启动，配置文件在 "),a("code",[s._v("/etc/xinetd.d/")]),s._v(" 目录。使用 "),a("code",[s._v("Telnet")]),s._v(" 服务为例, 目前Telnet服务器默认是不安装的，需要手工安装。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 telnet")]),s._v("\n$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" telnet telnet-server -y\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 编辑 telnet 配置")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/xinetd.d/telnet\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" telnet "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  flags           "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" REUSE\n  socket_type     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" stream\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wait")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no\n  user            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root\n  server          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /usr/sbin/in.telnetd\n  log_on_failure  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" USERID\n  disable         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# no表示启动服务，yes表示停止服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动 xinetd 服务器")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" xinetd start\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 xinetd服务列表")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"telnet"')]),s._v("\ntelnet:         on\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -tlun|grep 23")]),s._v("\ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::23                   :::*                    LISTEN     \nudp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:323           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*                          \nudp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:323                 :::* \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h2",{attrs:{id:"使用-chkconfig-命令管理自启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-chkconfig-命令管理自启动"}},[s._v("#")]),s._v(" 使用 chkconfig 命令管理自启动")]),s._v(" "),a("p",[s._v("chkconfig 管理基于xinetd自启动的命令格式如下:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#基于xinetd服务没有运行级别，不用指定--level选项")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" 服务名 on"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("off\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"源码包服务的启动管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码包服务的启动管理"}},[s._v("#")]),s._v(" 源码包服务的启动管理")]),s._v(" "),a("p",[s._v("源码包服务的文件都会安装到指定目录，包括管理脚本程序。因此只要找到管理脚本，然后执行即可。但是每个服务的启动脚本都不一样，怎么确定？安装时的说明文档(INSTALL|README)中会明确地说明启动脚本是哪个文件。比如 apache 服务的启动脚本就是 "),a("code",[s._v("/usr/local/apache2/bin/apachectl")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"源码包服务的自启动管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码包服务的自启动管理"}},[s._v("#")]),s._v(" 源码包服务的自启动管理")]),s._v(" "),a("p",[s._v("源码包服务的自启动管理不能依靠系统的服务管理命令，而只能把标准启动命令写入 "),a("code",[s._v("/etc/rc.d/rc.local")]),s._v(" 文件中, 系统在启动过程中调用启动脚本，从而让该服务开机自启动。")]),s._v(" "),a("h2",{attrs:{id:"手动配置源码包自启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#手动配置源码包自启动"}},[s._v("#")]),s._v(" 手动配置源码包自启动")]),s._v(" "),a("p",[s._v("在默认情况下，源码包服务是不能被系统的服务管理命令所识别和管理的，但是可以配置设定让源码包服务被系统的服务管理命令识别。不过不推荐，因为会混淆服务类型，不利于系统维护管理。")]),s._v(" "),a("h2",{attrs:{id:"service方案-不推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service方案-不推荐"}},[s._v("#")]),s._v(" service方案(不推荐)")]),s._v(" "),a("p",[a("code",[s._v("service")]),s._v("只是在"),a("code",[s._v("/etc/init.d/")]),s._v("目录中查找是否有服务的启动脚本，所以只要手动建立软链接把启动脚本链接到目录即可")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s /usr/local/apache2/bin/apachectl /etc/±nit.d/apache\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# service命令可以管理 apache服务")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" apache restart\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"chkconfig管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chkconfig管理"}},[s._v("#")]),s._v(" chkconfig管理")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/init.d/apache\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\nchkconfig: - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 格式  chkconfig:运行级别 启动顺序 关闭顺序")]),s._v("\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --add apache\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chkconfig")]),s._v(" --list "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" apache\napache    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":off   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":off   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":off   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":on   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(":off   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(":on   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(":off\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("ul",[a("li",[s._v("如果想让源码包服务被"),a("code",[s._v("service")]),s._v("命令所识别和管理，则只需做一个软链接把启动脚本链接到 "),a("code",[s._v("/etc/init.d/")]),s._v(" 目录中即可。")]),s._v(" "),a("li",[s._v("chkconfig 命令: 把启动脚本链接到 "),a("code",[s._v("/etc/init.d/")]),s._v(" 目录，启动脚本加入: "),a("code",[s._v("chkconfig:运行级别 启动顺序 关闭")]),s._v(", 然后用 "),a("code",[s._v("chkconfig --add 服务名")]),s._v(" 把服务加入 "),a("code",[s._v("chkconfig")]),s._v(" 管理。")])]),s._v(" "),a("h2",{attrs:{id:"常见服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见服务"}},[s._v("#")]),s._v(" 常见服务")]),s._v(" "),a("p",[s._v("服务器维护的工作就是优化服务，即关闭不需要的服务，只开启需要的服务。因此就需要知道各种服务的功能。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("服务名称")]),s._v(" "),a("th",[s._v("功能简介")]),s._v(" "),a("th",[s._v("建议")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("anacron")]),s._v(" "),a("td",[s._v("系统的定时任务程序")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("atd")]),s._v(" "),a("td",[s._v("指定系统在特定时间执行某个任务，只能执行一次")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("bluetooth")]),s._v(" "),a("td",[s._v("蓝牙设备，一般不会在服务器上启用蓝牙")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("cpuspeed")]),s._v(" "),a("td",[s._v("调整CPU频率，当闲置时自动降低CPU频率来节省电量")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("crond")]),s._v(" "),a("td",[s._v("系统的定时任务")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("dovecot")]),s._v(" "),a("td",[s._v("邮件服务中 POP3/IMAP 服务的守护进程，主要用来接收信件。")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("gpm")]),s._v(" "),a("td",[s._v("在字符终端 (ttyl~tty6) 中可以使用鼠标复制和粘贴，这就是这个服务的功能")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("haldaemon")]),s._v(" "),a("td",[s._v("检测和支持USB设备，如果是服务器则关闭，个人机建议开启")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("hidd")]),s._v(" "),a("td",[s._v("蓝牙设备检测，必须启动 bluetooth 服务")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("httpd")]),s._v(" "),a("td",[s._v("apache 服务的守护进程。如果需要启动 apache，就开启")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("iptables")]),s._v(" "),a("td",[s._v("防火墙功能，服务器的主要防护手段必须开启")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("irda")]),s._v(" "),a("td",[s._v("IrDA 提供红外线设备的通信支持")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("irqbalance")]),s._v(" "),a("td",[s._v("支持多核处理器，让CPU自动分配系统中断提高性能，多核CPU请开启")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("kudzu")]),s._v(" "),a("td",[s._v("开机时进行硬件检测，调用相关设置软件，建议关闭")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("mcstrans")]),s._v(" "),a("td",[s._v("SELinux 的支持服务，建议开启")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("messagebus")]),s._v(" "),a("td",[s._v("IPC进程间通信服务，在软件中交换信息，建议关闭")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("mysqld")]),s._v(" "),a("td",[s._v("MySQL数据库服务器")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("named")]),s._v(" "),a("td",[s._v("DNS服务的守护进程，用来进行域名解析，如果是DNS服务器开启否则关闭")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("netfs")]),s._v(" "),a("td",[s._v("自动挂载网络中的共享文件空间，比如 NFS、Samba 等")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("network")]),s._v(" "),a("td",[s._v("提供网络设罝管理功能，建议开启")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("nfs")]),s._v(" "),a("td",[s._v("NFS服务，Linux主机之间的文件共享服务")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("portmap")]),s._v(" "),a("td",[s._v("用在远程过程调用RPC的服务，如果没有RPC服务可以关闭")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("rsync")]),s._v(" "),a("td",[s._v("远程数据备份守护进程")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("sendmail")]),s._v(" "),a("td",[s._v("sendmail 邮件服务的守护进程，根据邮件服务设置")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("setroubleshoot")]),s._v(" "),a("td",[s._v("将SELinux信息记录在日志中，建议开启")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("smartd")]),s._v(" "),a("td",[s._v("该服务用于自动检测硬盘状态，建议开启")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("smb")]),s._v(" "),a("td",[s._v("网络服务 samba 的守护进程，让Linux和Windows共享数据")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("squid")]),s._v(" "),a("td",[s._v("代理服务的守护进程")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("sshd")]),s._v(" "),a("td",[s._v("ssh 加密远程登录管理的服务, 远程管理必须使用")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("syslog")]),s._v(" "),a("td",[s._v("日志的守护进程")]),s._v(" "),a("td",[s._v("开启")])]),s._v(" "),a("tr",[a("td",[s._v("vsftpd")]),s._v(" "),a("td",[s._v("vsftp 服务的守护进程")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("xfs")]),s._v(" "),a("td",[s._v("X Window字体守护进程，提供字体服务。如果不启动图形界面不用开启")]),s._v(" "),a("td",[s._v("关闭")])]),s._v(" "),a("tr",[a("td",[s._v("xinetd")]),s._v(" "),a("td",[s._v("超级守护进程。如果有依赖 xinetd 的服务，就必须开启")]),s._v(" "),a("td",[s._v("开启")])])])]),s._v(" "),a("h2",{attrs:{id:"什么是-daemon-与服务service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-daemon-与服务service"}},[s._v("#")]),s._v(" 什么是 daemon 与服务service")]),s._v(" "),a("p",[s._v("启动一个程序提供功能，那么这个程序就是 "),a("code",[s._v("daemon")]),s._v("，程序提供的功能就是 "),a("code",[s._v("service")]),s._v("。"),a("code",[s._v("daemon")]),s._v(" 的命名方式，一般在原程序后面添加字母"),a("code",[s._v("d")]),s._v("，使用 "),a("code",[s._v("ps")]),s._v(" 和 "),a("code",[s._v("top")]),s._v(" 可以看到很多后缀为"),a("code",[s._v("d")]),s._v("的 "),a("code",[s._v("daemon")]),s._v(" 程序。")]),s._v(" "),a("h2",{attrs:{id:"init服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#init服务"}},[s._v("#")]),s._v(" init服务")]),s._v(" "),a("p",[s._v("Unix系统服务管理通过 "),a("code",[s._v("init")]),s._v("进程 唤醒所有的系统所需要的服务。所有的服务启动脚本放在 "),a("code",[s._v("/etc/init.d/")]),s._v("，使用 "),a("code",[s._v("bash script")]),s._v(" 脚本程序，管理命令 "),a("code",[s._v("/etc/init.d/daemon start|stop|restart|status")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"执行等级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行等级"}},[s._v("#")]),s._v(" 执行等级")]),s._v(" "),a("p",[a("code",[s._v("init")]),s._v("根据执行等级"),a("code",[s._v("runlevel")]),s._v("来唤醒不同的服务，以进入不同的操作界面。各等级启动脚本通过 "),a("code",[s._v("/etc/rc.d/rc[0-6]/SXXdaemon")]),s._v(" 连结到 "),a("code",[s._v("/etc/init.d/daemon")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("0. -\n1. 单人维护模式\n2. -\n3. 纯文本模式\n4. -\n5. 文字加图形界面\n6. -\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"systemd的优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemd的优点"}},[s._v("#")]),s._v(" systemd的优点")]),s._v(" "),a("p",[s._v("从 "),a("code",[s._v("CentOS 7.x")]),s._v(" 后，改用 "),a("code",[s._v("systemd")]),s._v(" 启动服务管理机制。好处如下")]),s._v(" "),a("ul",[a("li",[s._v("并行处理所有服务加速开机: init 启动脚本是依序启动，不想依赖的服务也是等待启动，"),a("code",[s._v("systemd")]),s._v(" 可以让所有服务同时启动，加快系统启动速度。")]),s._v(" "),a("li",[s._v("on-demand 启动方式: 只有一个 "),a("code",[s._v("systemd")]),s._v(" 服务搭配 "),a("code",[s._v("systemctl")]),s._v(" 指令处理，无需额外支持。")]),s._v(" "),a("li",[s._v("服务相互依赖自我检查: 可以自定义服务相依性检查，比如定义B依赖A时，自动启动A服务")]),s._v(" "),a("li",[s._v("根据 "),a("code",[s._v("daemon")]),s._v(" 功能分类: 将所有服务定义为"),a("code",[s._v("unit")]),s._v("并且归类"),a("code",[s._v("type")]),s._v("，比如 "),a("code",[s._v("service")]),s._v("、"),a("code",[s._v("socket")]),s._v("、"),a("code",[s._v("target")]),s._v("、"),a("code",[s._v("path")]),s._v("、"),a("code",[s._v("snapshot")]),s._v("、"),a("code",[s._v("timer")]),s._v(" ，方便管理员的分类与记忆。")]),s._v(" "),a("li",[s._v("将多个 "),a("code",[s._v("saemons")]),s._v(" 集合成群组: 将多个"),a("code",[s._v("daemons")]),s._v("功能集合成为一个 "),a("code",[s._v("target")]),s._v(" 项目，执行某个 "),a("code",[s._v("target")]),s._v(" 就是执行好多个 "),a("code",[s._v("daemon")]),s._v("。")]),s._v(" "),a("li",[s._v("向下兼容旧的 "),a("code",[s._v("init")]),s._v(" 服务脚本: 目前没有办法支持 "),a("code",[s._v("init")]),s._v(" 服务脚本，只支持普通功能")])]),s._v(" "),a("h2",{attrs:{id:"systemd缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemd缺点"}},[s._v("#")]),s._v(" systemd缺点")]),s._v(" "),a("p",[s._v("systemd 某些地方无法完全取代 init，如:")]),s._v(" "),a("ul",[a("li",[s._v("在 "),a("code",[s._v("runlevel")]),s._v(" 的对应上，仅有 "),a("code",[s._v("1|3|4")]),s._v(" 对应到 "),a("code",[s._v("systemd")]),s._v(" 的某些 "),a("code",[s._v("target")]),s._v(" 类型")]),s._v(" "),a("li",[s._v("支持的语法有限制，无法像 "),a("code",[s._v("/etc/init.d/daemon")]),s._v(" 纯脚本自定义参数")]),s._v(" "),a("li",[s._v("如果启动时是通过手动启动的，"),a("code",[s._v("systemd")]),s._v(" 将无法管理该服务")]),s._v(" "),a("li",[a("code",[s._v("systemd")]),s._v(" 启动不支持标准IO，因此编写 "),a("code",[s._v("systemd")]),s._v(" 的启动设置时，必须取消互动机制")])]),s._v(" "),a("h2",{attrs:{id:"systemd-的配置文件目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemd-的配置文件目录"}},[s._v("#")]),s._v(" systemd 的配置文件目录")]),s._v(" "),a("p",[a("code",[s._v("systemd")]),s._v(" 将 "),a("code",[s._v("daemon")]),s._v(" 执行脚本称为服务单位 "),a("code",[s._v("unit")]),s._v("，每种服务单位按功能分为不同的类型，配置文件在以下位置。")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("/etc/systemd/system")]),s._v(": 管理员按系统需求建立的执行脚本，类似"),a("code",[s._v("/etc/rc.d/rc5.d/Sxx")]),s._v("功能，优先顺序最高")]),s._v(" "),a("li",[a("code",[s._v("/run/systemd/system")]),s._v(": 系统执行过程中所产生的服务脚本，优先顺序其次")]),s._v(" "),a("li",[a("code",[s._v("/usr/lib/systemd/system")]),s._v(": 每个服务主要启动脚本设置，类似"),a("code",[s._v("/etc/init.d/")]),s._v("中文件，优先顺序最低")])]),s._v(" "),a("blockquote",[a("p",[s._v("注意: 要修改某个服务启动的设置，应该修改 "),a("code",[s._v("/usr/lib/systemd/system")]),s._v(" 下配置，"),a("code",[s._v("/etc/systemd/system")]),s._v("只是软链接文件")])]),s._v(" "),a("h2",{attrs:{id:"文件的扩展名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件的扩展名"}},[s._v("#")]),s._v(" 文件的扩展名")]),s._v(" "),a("p",[s._v("可通过查看文件的扩展名，区分 "),a("code",[s._v("/usr/lib/systemd/system")]),s._v(" 下的数据类型。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询 vsftpd 和 crond 服务")]),s._v("\n$ ll /usr/lib/systemd/system/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -E "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'(vsftpd|multi|cron)'")]),s._v("\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("318")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" crond.service\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("171")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" vsftpd.service\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" vsftpd.target\n-rw-r--r--. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("184")]),s._v(" Oct "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" vsftpd@.service\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"unit-类型分类说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unit-类型分类说明"}},[s._v("#")]),s._v(" unit 类型分类说明")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("扩展名")]),s._v(" "),a("th",[s._v("主要服务功能")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v(".service")]),s._v(" "),a("td",[s._v("一般系统服务类型，包括本地服务和网络服务")])]),s._v(" "),a("tr",[a("td",[s._v(".socket")]),s._v(" "),a("td",[s._v("内部程序数据交换的 socket 服务 socket unit")])]),s._v(" "),a("tr",[a("td",[s._v(".target")]),s._v(" "),a("td",[s._v("一群服务集合")])]),s._v(" "),a("tr",[a("td",[s._v(".mount、.automount")]),s._v(" "),a("td",[s._v("文件系统挂载相关的服务")])]),s._v(" "),a("tr",[a("td",[s._v(".path")]),s._v(" "),a("td",[s._v("侦测特定文件或目录类型, 比如打印服务侦测打印队列目录启动打印功能")])]),s._v(" "),a("tr",[a("td",[s._v(".timer")]),s._v(" "),a("td",[s._v("循环执行的服务，类似 anacrontab")])])])]),s._v(" "),a("h2",{attrs:{id:"通过-systemctl-管理服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过-systemctl-管理服务"}},[s._v("#")]),s._v(" 通过 systemctl 管理服务")]),s._v(" "),a("p",[a("code",[s._v("systemd")]),s._v(" 启动服务的机制，主要是通过 "),a("code",[s._v("systemctl")]),s._v(" 指令来处理。以前的系统需要 "),a("code",[s._v("service|chkconfig|setup|init")]),s._v(" 等指令来完成。其指令格式如下:")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\ncommond清单: \n- start:     启动 unit\n- stop:      关闭 unit\n- restart:   重启 unit\n- reload:    重载配置文件\n- enable:    设置开机启动\n- disable:   取消开机启动\n- status:    显示服务信息\n- is-active: 目前是否在运行\n- is-enable: 是否开机启动\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"范例-1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例-1"}},[s._v("#")]),s._v(" 范例 1")]),s._v(" "),a("p",[s._v("看看目前 atd 这个服务的状态")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Loaded: 开机是否启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Active: 是否正在运行中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后一行: 该服务的启动信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录文件格式为: 时间、信息发送主机、哪一个服务的信息、实际信息内容")]),s._v("\n$ systemctl status atd.service \n* atd.service - Job spooling tools\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/atd.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Tue "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-17 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":49:55 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" day 5h ago\n Main PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1398")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("atd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    Tasks: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n   CGroup: /system.slice/atd.service\n           -1398 /usr/sbin/atd -f\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":49:55 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started Job spooling tools.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"范例-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例-2"}},[s._v("#")]),s._v(" 范例 2")]),s._v(" "),a("p",[s._v("正常关闭 atd 服务，非 kill -9")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最后两行信息是执行 stop 后发生的事件日志信息")]),s._v("\n$ systemctl stop atd.service \n$ systemctl status atd.service \n* atd.service - Job spooling tools\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/atd.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: inactive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dead"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since Wed "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":40:06 CST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 13s ago\n  Process: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1398")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/atd -f "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n Main PID: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1398")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":49:55 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started Job spooling tools.\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":40:06 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Stopping Job spooling tools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":40:06 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Stopped Job spooling tools.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h2",{attrs:{id:"active状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#active状态"}},[s._v("#")]),s._v(" Active状态")]),s._v(" "),a("p",[s._v("不要用 "),a("code",[s._v("kill")]),s._v(" 关掉正常的服务，否则 "),a("code",[s._v("systemctl")]),s._v(" 无法监控。 "),a("code",[s._v("Active")]),s._v(" 状态有多个状态:")]),s._v(" "),a("ul",[a("li",[s._v("active(running): 有一个或多个程序正在运行")]),s._v(" "),a("li",[s._v("active(exited): 仅执行一次就正常结束的服务，目前并没有任何程序在系统中执行。")]),s._v(" "),a("li",[s._v("active(waiting): 正在执行中中，不过在在等待其他的事件才能继续处理")]),s._v(" "),a("li",[s._v("inactive: 这个服务目前没有运行")])]),s._v(" "),a("h2",{attrs:{id:"开机预设状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开机预设状态"}},[s._v("#")]),s._v(" 开机预设状态")]),s._v(" "),a("p",[s._v("开机预设状态有以下:")]),s._v(" "),a("ul",[a("li",[s._v("enabled: 开机执行")]),s._v(" "),a("li",[s._v("disabled: 开机不执行")]),s._v(" "),a("li",[s._v("static: 不可以自己启动, 可能会被其他的服务唤醒")]),s._v(" "),a("li",[s._v("mask: 无法被启动，因为已经被强制注销, 可通过 unmask 恢复")])]),s._v(" "),a("h2",{attrs:{id:"观察系统上所有的服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#观察系统上所有的服务"}},[s._v("#")]),s._v(" 观察系统上所有的服务")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("systemctl "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("TYPE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\ncommand: \n    list-units: 按 unit 列出目前有启动的 unit。若加上 --all 才会列出没有启动的\n    list-unit-files: 按 "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("/usr/lib/systemd/system"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" 内的文件，将所有文件列表说明\n--type: 之前提到过的 unit type，主要有 service、socket、target 等\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"范例-1-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例-1-2"}},[s._v("#")]),s._v(" 范例 1")]),s._v(" "),a("p",[s._v("列出系统上有启动的 unit, "),a("code",[s._v("systemctl")]),s._v(" 不加参数，预设是 "),a("code",[s._v("list-units")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# UNIT: 项目名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LOAD: 开机时是否会被加载")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ACTIVE: 目前的状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# DESCRIPTION: 详细描述")]),s._v("\n$ systemctl\nUNIT                        LOAD      ACTIVE SUB       DESCRIPTION              \n  proc-sys-fs-binfmt_misc.automount loaded    active running   Arbitrary Executable File Formats File System Aut"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  sys-devices-pci0000:00-0000:00:01.1-ata2-host1-target1:0:0-1:0:0:0-block-sr0.device loaded    active plugged  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  sys-devices-pci0000:00-0000:00:03.0-virtio0-net-ens3.device loaded    active plugged   Virtio network device  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  sys-devices-pci0000:00-0000:00:04.0-virtio1-block-vda-vda1.device loaded    active plugged   /sys/devices/pci"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h3",{attrs:{id:"范例-2-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例-2-2"}},[s._v("#")]),s._v(" 范例 2")]),s._v(" "),a("p",[s._v("列出所有已经安装的 unit 有哪些")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ systemctl list-unit-files \nUNIT FILE                                     STATE   \nproc-sys-fs-binfmt_misc.automount             static  \ndev-hugepages.mount                           static  \ndev-mqueue.mount                              static \nabrt-ccpp.service                             enabled \nabrt-oops.service                             enabled \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"范例-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例-3"}},[s._v("#")]),s._v(" 范例 3")]),s._v(" "),a("p",[s._v("只列出某种类型的 unit")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只显示 .service 类型的服务")]),s._v("\n$ systemctl list-units --type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("service --all\n  UNIT                                                  LOAD      ACTIVE   SUB     DESCRIPTION\n  abrt-ccpp.service                                     loaded    active   exited  Install ABRT coredump hook\n  abrt-oops.service                                     loaded    active   running ABRT kernel log watcher\n  abrt-vmcore.service                                   loaded    inactive dead    Harvest vmcores "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" ABRT\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查找是否有 cpu 为名的服务")]),s._v("\n$ systemctl list-units --type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("service --all "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" cpu\n  cpupower.service                                      loaded    inactive dead    Configure CPU power \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"systemctl-针对-service-类型的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemctl-针对-service-类型的配置"}},[s._v("#")]),s._v(" systemctl 针对 service 类型的配置")]),s._v(" "),a("p",[s._v("以前建立系统服务，需要在 "),a("code",[s._v("/etc/init.d/")]),s._v(" 创建对应的 "),a("code",[s._v("script")]),s._v("，如今在 "),a("code",[s._v("systemd")]),s._v(" 环境下，该怎么设置相关的服务启动环境？")]),s._v(" "),a("h2",{attrs:{id:"配置文件相关目录简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件相关目录简介"}},[s._v("#")]),s._v(" 配置文件相关目录简介")]),s._v(" "),a("p",[a("code",[s._v("systemd")]),s._v(" 的配置文件大部分在 "),a("code",[s._v("/usr/lib/systemd/system/")]),s._v(" 目录内，该目录的文件主要是"),a("strong",[s._v("默认设置建议不要修改")]),s._v("。管理员应该修改的目录是 "),a("code",[s._v("/etc/systemd/system/")]),s._v("。")]),s._v(" "),a("p",[s._v("比如: 想要额外修改 vsftpd.service ，建议放到的位置如下:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("/usr/lib/systemd/vsftpd.service")]),s._v(" : 默认配置文件")]),s._v(" "),a("li",[a("code",[s._v("/etc/systemd/system/vsftp.service.d/custom.conf")]),s._v(": 建立同名以 "),a("code",[s._v(".d")]),s._v(" 后缀结尾的目录，该配置会覆盖掉默认配置文件")]),s._v(" "),a("li",[a("code",[s._v("/etc/systemd/system/vsftpd.service.wants/*")]),s._v(": 设置相依服务的链接, 启动服务后启动建议服务")]),s._v(" "),a("li",[a("code",[s._v("/etc/systemd/system/vsftpd.service.requires/*")]),s._v(": 设置相依服务的链接, 启动服务前启动建议服务")])]),s._v(" "),a("h2",{attrs:{id:"配置文件的设置项目简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件的设置项目简介"}},[s._v("#")]),s._v(" 配置文件的设置项目简介")]),s._v(" "),a("p",[s._v("通过 "),a("code",[s._v("sshd.service")]),s._v(" 的配置文件来讲解配置文件的内容")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /usr/lib/systemd/system/sshd.service\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("OpenSSH server daemon\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("man:sshd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" man:sshd_config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target sshd-keygen.service\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Wants")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sshd-keygen.service\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该项目于实际执行的指令参数有关")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("EnvironmentFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/sysconfig/sshd\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/sshd -D "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$OPTIONS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/kill -HUP "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MAINPID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KillMode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("process\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("RestartSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("42s\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此 unit 要挂载到哪个 target 下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h2",{attrs:{id:"配置文件组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件组成"}},[s._v("#")]),s._v(" 配置文件组成")]),s._v(" "),a("p",[s._v("配置文件大概分为三个部分:")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("[Unit]")]),s._v(": unit说明和其他依赖 "),a("code",[s._v("daemon")]),s._v(" 的设置")]),s._v(" "),a("li",[a("code",[s._v("[Service]|[Socket][Timer][Mount][Path]...")]),s._v(": 不同的 unit type 需要使用对应的设置项目，规范服务启动脚本、环境配置文件名、重新启动的方式等")]),s._v(" "),a("li",[a("code",[s._v("[Install]")]),s._v(": unit挂载的 target 位置")])]),s._v(" "),a("h2",{attrs:{id:"配置文件规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件规则"}},[s._v("#")]),s._v(" 配置文件规则")]),s._v(" "),a("p",[s._v("配置文件内有些设置规则如下:")]),s._v(" "),a("ul",[a("li",[s._v("设置项目通常是可以重复的: 可以设置两个 "),a("code",[s._v("After")]),s._v("，不过后者会取代前者，可以用 "),a("code",[s._v("After=")]),s._v(" 清空该项")]),s._v(" "),a("li",[s._v("设置参数是布尔类型，可以使用 "),a("code",[s._v("1|yes|true|on")]),s._v(" 代表启动，"),a("code",[s._v("0|no|false|off")]),s._v(" 代表关闭")]),s._v(" "),a("li",[s._v("空白行、开头为 "),a("code",[s._v("#")]),s._v(" 或 "),a("code",[s._v(";")]),s._v(" 都表示批注信息")])]),s._v(" "),a("h2",{attrs:{id:"unit-部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unit-部分"}},[s._v("#")]),s._v(" [unit]部分")]),s._v(" "),a("ul",[a("li",[s._v("Description: 使用 "),a("code",[s._v("systemctl list-units")]),s._v(" 时，显示的说明")]),s._v(" "),a("li",[s._v("Documentation: 提供管理员能够进一步的文件查询功能")]),s._v(" "),a("li",[s._v("After: 说明 "),a("code",[s._v("unit")]),s._v(" 是在哪个 "),a("code",[s._v("daemon")]),s._v(" 启动之后才能启动")]),s._v(" "),a("li",[s._v("Before: 在什么服务启动前，启动本服务")]),s._v(" "),a("li",[s._v("Rrquires: 相依性配置, "),a("code",[s._v("unit")]),s._v(" 需要在哪个 "),a("code",[s._v("daemon")]),s._v(" 启动后才能启动，否则不会启动")]),s._v(" "),a("li",[s._v("Wants: unit 启动之后，还需要启动哪些服务")]),s._v(" "),a("li",[s._v("Conflicts: 冲突服务")])]),s._v(" "),a("h2",{attrs:{id:"service-部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-部分"}},[s._v("#")]),s._v(" [service]部分")]),s._v(" "),a("ul",[a("li",[s._v("Type: 启动方式，会影响到 ExecStart。一般有 simple|forking|oneshot|dbus|idle")]),s._v(" "),a("li",[s._v("EnvironmentFile: 指定启动脚本的环境配置文件")]),s._v(" "),a("li",[s._v("ExecStart: 实际执行此 "),a("code",[s._v("daemon")]),s._v(" 的指令或脚本程序")]),s._v(" "),a("li",[s._v("ExecStop: 关闭服务时所执行的指令")]),s._v(" "),a("li",[s._v("ExecReload: 重新加载时所执行的指令")]),s._v(" "),a("li",[s._v("Restart: 设置 "),a("code",[s._v("1")]),s._v(" 时，当此 "),a("code",[s._v("daemon")]),s._v(" 服务终止后，会再次启动该服务")]),s._v(" "),a("li",[s._v("RemainAfterExit: 设置 "),a("code",[s._v("1")]),s._v(" 时，当 "),a("code",[s._v("daemon")]),s._v(" 所属的所有程序都终止后，服务会再尝试启动。")]),s._v(" "),a("li",[s._v("TimeoutSec: 在启动关闭时，因为某些缘故导致无法顺利启动结束，在进入强制结束状态之前的等待时间")]),s._v(" "),a("li",[s._v("KillMode: 可以是 "),a("code",[s._v("process|control-group|none")]),s._v(" 中的一种")]),s._v(" "),a("li",[s._v("RestartSec: 服务重新启动时的 sleep 时间，预设是 "),a("code",[s._v("100ms")])])]),s._v(" "),a("h2",{attrs:{id:"install-部分"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-部分"}},[s._v("#")]),s._v(" [Install]部分")]),s._v(" "),a("ul",[a("li",[s._v("WantedBy: unit挂在哪一个 target, 大部分都是 "),a("code",[s._v("*.target unit")]),s._v(" 。")]),s._v(" "),a("li",[s._v("Also: 相依性 enable")]),s._v(" "),a("li",[s._v("Alias: 别名")])]),s._v(" "),a("h3",{attrs:{id:"范例-1-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例-1-3"}},[s._v("#")]),s._v(" 范例 1")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制启动脚本")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/systemd/system/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /usr/lib/systemd/system/vsftpd.service vsftpd.service\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" vsftpd.service\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载配置文件")]),s._v("\n$ systemctl daemon-reload\n$ systemctl list-unit-files --all "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" vsftpd\nvsftpd.service                                enabled\n$ systemctl status vsftpd.service\n* vsftpd.service - vsftpd "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftp")]),s._v(" daemon\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/systemd/system/vsftpd.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: active\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h3",{attrs:{id:"范例2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#范例2"}},[s._v("#")]),s._v(" 范例2")]),s._v(" "),a("p",[s._v("制作一个可以备份自己系统的服务，这脚本放在 "),a("code",[s._v("/backups")]),s._v(" 下，内容如下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /backups \n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /backups/backup.sh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc /home /root /var/lib /var/spool/{cron,at,mail}"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/backups/backup-system-'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y-%m-%d"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('.tar.gz"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d /backups "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /backups\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zcvf "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${target}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${source}")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /backups/backup.log\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" a+x /backups/backup.sh\n$ ll /backups/backup.sh\n-rwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:24 /backups/backup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("准备 "),a("code",[s._v("backup.service")]),s._v(" 的启动脚本")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/systemd/system/backup.service\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("backup my server\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Requires")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("atd.service\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("simple\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/bin/bash -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" echo /backups/backup.sh | at now"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为 ExecStart 里面用到了 at 指令，因此 atd.service 是一定需要的服务")]),s._v("\n\n$ systemctl daemon-reload\n$ systemctl start backup.service\n$ systemctl status backup.service\n* backup.service - backup my server\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/etc/systemd/system/backup.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: inactive "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dead"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:30:56 study.centos.mrcode systemd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started backup my server.\nMar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:30:56 study.centos.mrcode bash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17748")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": job "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" at Fri Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" 09:30:00 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 服务状态是 inactive ，因为不是驻留内存的服务，执行完成就退出")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h2",{attrs:{id:"systemctl-针对-timer-的配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemctl-针对-timer-的配置文件"}},[s._v("#")]),s._v(" systemctl 针对 timer 的配置文件")]),s._v(" "),a("p",[s._v("某些时候需要定期执行某项工作，或开机后执行，或是某服务启动多久后执行的需求。以前用 "),a("code",[s._v("crond")]),s._v(" 处理定期任务，现在可以用 "),a("code",[s._v("timers.target")]),s._v(" 可以定期处理各种任务。")]),s._v(" "),a("h2",{attrs:{id:"systemd-timer-优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#systemd-timer-优缺点"}},[s._v("#")]),s._v(" systemd.timer 优缺点")]),s._v(" "),a("p",[s._v("systemd.timer 的优势如下。")]),s._v(" "),a("ul",[a("li",[s._v("所有 "),a("code",[s._v("systemd")]),s._v(" 服务产生"),a("code",[s._v("log")]),s._v("都会被记录，因此 "),a("code",[s._v("debug")]),s._v(" 更清楚方便")]),s._v(" "),a("li",[s._v("各项 "),a("code",[s._v("timer")]),s._v(" 工作可以跟 "),a("code",[s._v("systemd")]),s._v(" 的服务相结合")]),s._v(" "),a("li",[s._v("各项 "),a("code",[s._v("timer")]),s._v(" 工作可以跟 "),a("code",[s._v("control group")]),s._v(" 结合来限制资源利用")]),s._v(" "),a("li",[s._v("时间安排可以精确到毫秒的单位")])]),s._v(" "),a("blockquote",[a("p",[s._v("缺点: 没有 email 通知功能，也没有 anacron 一段时间内的随机取样功能")])]),s._v(" "),a("h2",{attrs:{id:"任务需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#任务需求"}},[s._v("#")]),s._v(" 任务需求")]),s._v(" "),a("p",[a("code",[s._v("systemd")]),s._v(" 的 "),a("code",[s._v("timer")]),s._v(" 功能，必须有如下条件:")]),s._v(" "),a("ul",[a("li",[s._v("系统的 "),a("code",[s._v("timer.target")]),s._v(" 必须启动")]),s._v(" "),a("li",[s._v("要有 "),a("code",[s._v("sname.service")]),s._v(" 的服务存在("),a("code",[s._v("sname")]),s._v(" 是自定义的名称)")]),s._v(" "),a("li",[s._v("要有 "),a("code",[s._v("sname.timer")]),s._v(" 的时间启动服务存在")])]),s._v(" "),a("h2",{attrs:{id:"sname-timer-的设置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sname-timer-的设置"}},[s._v("#")]),s._v(" sname.timer 的设置")]),s._v(" "),a("p",[a("code",[s._v("[Timer]")]),s._v(" 部分")]),s._v(" "),a("ul",[a("li",[s._v("OnActiveSec: 当 timers.target 启动多久后才执行该 unit")]),s._v(" "),a("li",[s._v("OnBootSec: 当开机后多久之后才执行")]),s._v(" "),a("li",[s._v("OnStartupSec: 当 systemd 第一次启动后多久才执行")]),s._v(" "),a("li",[s._v("OnUnitActiveSec: 这个 timer 配置文件所管理的那个 unit 服务在最后一次启动后，相隔多久后再执行一次")]),s._v(" "),a("li",[s._v("OnUnitInactiveSec: 这个 timer 配置文件所管理的那个 unit 服务在最后一次停止后，隔多久再执行一次")]),s._v(" "),a("li",[s._v("OnCalendar: 使用实际时间(非循环时间)的方式来启动服务。时间格式后续讲解")]),s._v(" "),a("li",[s._v("Unit: sname.service 与 sname.timer 中的 sname 不一致时，这里指向的 service unit")]),s._v(" "),a("li",[s._v("Persistent: 使用 "),a("code",[s._v("OnCalendar")]),s._v(" 设置时是否持续，默认 yes")])]),s._v(" "),a("h2",{attrs:{id:"使用-oncalendar-的时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-oncalendar-的时间"}},[s._v("#")]),s._v(" 使用 OnCalendar 的时间")]),s._v(" "),a("p",[s._v("从 "),a("code",[s._v("crontab")]),s._v(" 转成 "),a("code",[s._v("timer")]),s._v(" 功能，需要了解时间格式如下")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("英文周名 YYYY-MM-DD HH:MM:SS\nThu    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-20 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":00:00\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通常英文的写法: 小单位写在前面，大单位写后面、先秒、分、小时、天等")]),s._v("\n隔 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 小时:              3h 或 3hr 或 3hours\n隔 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" 分钟过 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" 秒:     10s 300m \n隔 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 天又 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" 分钟:      100m 5day\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"循环运行范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#循环运行范例"}},[s._v("#")]),s._v(" 循环运行范例")]),s._v(" "),a("p",[s._v("任务需求如下:")]),s._v(" "),a("ul",[a("li",[s._v("开机后 2 小时开始执行一次 "),a("code",[s._v("backup.service")])]),s._v(" "),a("li",[s._v("自从第一次执行后，未来每两天执行一次 "),a("code",[s._v("backup.service")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/systemd/system/backup.timer\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("backup my server timer\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Timer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OnBootSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("2hrs\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OnUnitActiveSec")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("2days\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n$ systemctl daemon-reload \n$ systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" backup.timer\nCreated symlink from /etc/systemd/system/multi-user.target.wants/backup.timer to /etc/systemd/system/backup.timer.\n$ systemctl restart backup.timer    \n$ systemctl list-unit-files "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" backup\nbackup.service           disabled                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只需要 timer 启动就 ok")]),s._v("\nbackup.timer             enabled\n\n$ systemctl show timers.target \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ConditionTimestamp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Tue "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-17 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":49:38 CST      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timer 这个 unit 启动的时间")]),s._v("\n\n$ systemctl show backup.service "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ExecMainStartTimestamp\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecMainStartTimestamp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Fri "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-20 09:38:19 CST  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# backup.service 上一次执行的时间")]),s._v("\n\n$ systemctl show backup.timer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" NextElapseUSecMonotonic \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NextElapseUSecMonotonic")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("4d 22h 48min "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(".756775s     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下一次执行距离 timers.target 的时间")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("h2",{attrs:{id:"固定日期案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#固定日期案例"}},[s._v("#")]),s._v(" 固定日期案例")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/systemd/system/backup2.timer\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("backup my server timer2\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Timer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("OnCalendar")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Sun *-*-* 02:00:00\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Persistent")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Unit")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("backup.service     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timer 名称与原来的 service 不一致")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n$ systemctl daemon-reload\n$ systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" backup2.timer\nCreated symlink from /etc/systemd/system/multi-user.target.wants/backup2.timer to /etc/systemd/system/backup2.timer.\n$ systemctl restart backup2.timer \n$ systemctl list-unit-files "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" backup\nbackup.service                                disabled\nbackup.timer                                  enabled \nbackup2.timer                                 enabled \n$ systemctl show timers.target "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ConditionTimestamp\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ConditionTimestamp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Tue "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-17 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":49:38 CST\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ConditionTimestampMonotonic")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15862087")]),s._v("\n$  systemctl show backup.service "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ExecMainStartTimestamp\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于运行一次，所以没有 NextElapseUSecMonotonic 值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 时间是 Unix 标准时间, 即跟 1970-01-01 00:00:00 比较")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 50 年 2个月 2周 5天 9小时才会执行，注意时间的基准值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecMainStartTimestamp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Fri "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-03-20 09:38:19 CST\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecMainStartTimestampMonotonic")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("254936756737")]),s._v("\n$ systemctl show backup2.timer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" NextElapseUSecRealtime\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NextElapseUSecRealtime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("50y 2month 2w 5d 9h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{475:function(s,a,n){"use strict";n.r(a);var t=n(12),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"ssh配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssh配置"}},[s._v("#")]),s._v(" SSH配置")]),s._v(" "),n("p",[s._v("编程实现 nginx 源代码的自动编译，并且将编译后的程序更新到远程服务器，并且将服务器的老版本应用和运行日志自动备份，最好通过浏览器远程显示所有备份的数据历史信息。")]),s._v(" "),n("p",[s._v("实现方法：")]),s._v(" "),n("ol",[n("li",[s._v("ssh配置免密命令执行")]),s._v(" "),n("li",[s._v("编写sh脚本，自动编译nginx")]),s._v(" "),n("li",[s._v("远程命令发送文件，备份")]),s._v(" "),n("li",[s._v("远程监控页面")])]),s._v(" "),n("h2",{attrs:{id:"_1-ssh配置免密命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-ssh配置免密命令"}},[s._v("#")]),s._v(" 1.SSH配置免密命令")]),s._v(" "),n("p",[s._v("首先说一下逻辑")]),s._v(" "),n("p",[s._v("1 本地机生成ssh密钥后在用户目录文件夹下会有.ssh文件")]),s._v(" "),n("p",[s._v("2 .ssh文件夹下有四个文件")]),s._v(" "),n("p",[s._v("authorized_keys 已经认证并信任的身份")]),s._v(" "),n("p",[s._v("id_rsa 生成的私钥文件")]),s._v(" "),n("p",[s._v("id_rsa.pub 生成的公钥文件（需要发送至远程服务器的文件）")]),s._v(" "),n("p",[s._v("known_hosts")]),s._v(" "),n("p",[s._v("本地机A的家目录下的.ssh目录下生成一对秘钥")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("ssh-keygen -t rsa -P "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#生成空密码")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" /root/.ssh/id_rsa.pub root@xx.xx.xx.xx:/root/.ssh/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("远程机B目录下执行")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" .ssh\nchattr -ia authorized_keys "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将文件属性修改为可更改")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(" authorized_keys "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改为文件权限")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" id_rsa.pub "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" authorized_keys "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#将公钥放到认证的密钥文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),s._v(" authorized_keys "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#修改文件权限")]),s._v("\nchattr +ia authorized_keys\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"_2-编写shell自动编译nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-编写shell自动编译nginx"}},[s._v("#")]),s._v(" 2.编写shell自动编译Nginx")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" nginx-auto.sh\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#写入文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-1.19.0.tar.gz"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -pq http://nginx.org/download/nginx-1.19.0.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf nginx-1.19.0.tar.gz "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解压")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" -y "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc libpcre3 libpcre3-dev libssl-dev libperl-dev zlib1g zlib1g-dev "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/null "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下载编译所需依赖与软件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.19.0 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入文件夹")]),s._v("\n./configure "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#确认配置文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" makerecord.txt\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("至此，nginx就编译好了")]),s._v(" "),n("p",[s._v("只需要到目标服务器上进行一次安装就好了")]),s._v(" "),n("p",[s._v("3.远程命令发送文件与备份")]),s._v(" "),n("p",[s._v("发送文件")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zcvf new-nginx.tar.gz nginx-1.19.0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/dev/null "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#先打包编译好的文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("scp")]),s._v(" new-nginx.tar.gz root@111.229.84.70:/root /dev/null "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发送编译好的文件")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("本地备份脚本")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\ntar -zcvf usr-sbin-bak.tar.gz /usr/sbin\ntar -zcvf var-log.bak.tar.gz /var/log\nif [ ! -d \"/usr/local/nginx\" ]; then\n\texit 0\nelse\n\ttar -zcvf usr-local-nginx-bak.tar.gz /usr/local/nginx\nfi\ntar -xvf new-nginx.tar.gz > dev/null\ncd new-nginx\n#make install #该句尝试执行\nexit 0\n'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" backup.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" remote.sh\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不需要有标准输出")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@111.229.84.70 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" backup.sh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /tmp/backup.txt "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开头不是/的可以舍弃")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);